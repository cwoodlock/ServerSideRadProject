package com.ships.services;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.time.LocalDate;
import java.time.format.DateTimeFormatter;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.ships.model.OrderInfo;
import com.ships.model.Ship;
import com.ships.model.ShippingCompany;
import com.ships.repositories.OrderInfoRepository;
import com.ships.repositories.ShipRepository;
import com.ships.repositories.ShippingCompanyRepository;

@Service // Define the following class as a service (https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/stereotype/Service.html)
public class OrderInfoService 
{
	
	@Autowired // This means to get the bean called OrderInterface, Which is auto-generated by Spring, we will use it to handle the data
	private OrderInfoRepository orderInfoRepository;

	@Autowired // This means to get the bean called OrderInterface, Which is auto-generated by Spring, we will use it to handle the data
	private ShipRepository shipRepository;
	
	@Autowired // This means to get the bean called OrderInterface, Which is auto-generated by Spring, we will use it to handle the data
	private ShippingCompanyRepository shippingCompanyRepository;

	@Autowired
	private ShipService shipService;
	
	private Ship ship;
	private ShippingCompany shippingCompany;
	
	public List<OrderInfo> findAll() {
		return (List<OrderInfo>) orderInfoRepository.findAll();
	}
	
	public OrderInfo save(OrderInfo orderInfo) {
		
		setCurrentDate(orderInfo);																			// sets the new order to the current date
		
		ship = shipRepository.findOne(orderInfo.getShip().getSid());										// it looks for the ship by its id to put it in the order table
		shippingCompany = shippingCompanyRepository.findOne(orderInfo.getShippingCompany().getScid());			// it looks for the shipping company by its id to put it in the order table
		
		ship.setShippingCompany(shippingCompany);															// it tells the ship which shipping companyis associated with it
		return orderInfoRepository.save(orderInfo);		
	}
	
	private void setCurrentDate(OrderInfo orderInfo){
		DateTimeFormatter dateFormat = DateTimeFormatter.ofPattern("yyyy-MM-dd");
		LocalDate now = LocalDate.now();;
		orderInfo.setDate(dateFormat.format(now));
	}
}
